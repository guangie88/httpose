version: v1.0
name: httpose build
agent:
  machine:
    type: e1-standard-2
  
  containers:
  - name: main
    image: semaphoreci/rust:1.38

blocks:
- name: "Lints and tests"
  task:
    jobs:
    - name: "Format check"
      commands:
      - rustup component add rustfmt
      - checkout
      - cargo fmt -v --all -- --check
    - name: "Style check"
      commands:
      - rustup component add clippy
      - checkout
      - cargo clippy -v --locked --all
    - name: "Unit test check"
      commands:
      - checkout
      - cargo test -v --locked --all

- name: "Build"
  task:
    jobs:
    - name: "Build binary"
      commands:
      - checkout
      - cargo build --release -v --locked --all
